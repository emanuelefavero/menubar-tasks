<!DOCTYPE html>
<html>
  <head>
    <title>Add Task</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --background: rgb(234, 235, 237);
        --foreground: rgb(39, 39, 39);

        /* INPUT */
        --input: rgb(222, 223, 224);
        --input-border: 1px solid rgb(215, 216, 217);
        --input-border-bottom: var(--input-border);

        /* INPUT FOCUS */
        --input-focus-outline: 3px solid rgb(132, 163, 230);

        /* BUTTON */
        --button: #fff;
        --button-border-top: 1px solid rgb(219, 220, 222);
        --button-border-bottom: 1px solid rgb(194, 195, 197);
        --button-shadow: 0 0 0 1px rgb(228, 228, 230);
        --button-primary: linear-gradient(
          180deg,
          rgb(72, 142, 247),
          rgb(51, 121, 246)
        );
        --button-primary-text: rgb(252, 253, 255);
        --button-primary-border-top: 1px solid rgb(73, 143, 247);
        --button-primary-border-bottom: 1px solid rgb(51, 121, 246);

        /* BUTTON ACTIVE */
        --button-active: rgb(240, 240, 240);
        --button-border-top-active: 1px solid rgb(219, 220, 222);
        --button-primary-active: linear-gradient(
          180deg,
          rgb(57, 123, 227),
          rgb(41, 101, 227)
        );
        --button-primary-border-top-active: 1px solid rgb(56, 122, 227);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --background: rgb(37, 39, 42);
          --foreground: rgb(222, 222, 223);

          /* INPUT */
          --input: rgb(49, 51, 53);
          --input-border: 1px solid rgb(56, 58, 60);
          --input-border-bottom: 1px solid rgb(79, 83, 84);

          /* INPUT FOCUS */
          --input-focus-outline: 3px solid rgb(57, 103, 144);

          /* BUTTON */
          --button: rgb(92, 93, 95);
          --button-border-top: 1px solid rgb(111, 113, 114);
          --button-border-bottom: 1px solid rgb(31, 33, 35);
          --button-shadow: 0 0 0 1px rgb(35, 37, 40);
          --button-primary: linear-gradient(
            180deg,
            rgb(49, 104, 222),
            rgb(42, 93, 198)
          );
          --button-primary-text: rgb(221, 229, 247);
          --button-primary-border-top: 1px solid rgb(81, 131, 228);
          --button-primary-border-bottom: 1px solid rgb(23, 24, 27);

          /* BUTTON ACTIVE */
          --button-active: rgb(116, 117, 119);
          --button-border-top-active: 1px solid rgb(134, 135, 136);
          --button-primary-active: linear-gradient(
            180deg,
            rgb(78, 158, 235),
            rgb(70, 145, 223)
          );
          --button-primary-border-top-active: 1px solid rgb(104, 176, 240);
        }
      }

      #form {
        font-family: -apple-system, system-ui, BlinkMacSystemFont, 'SF Pro',
          'San Francisco Pro', 'Helvetica Neue', Helvetica, sans-serif;
        background-color: var(--background);
        color: var(--foreground);
        padding: 1rem;
        max-width: 65ch;
        display: flex;
        flex-direction: column;

        & #label {
          font-size: 0.875rem;
          font-weight: 600;
          padding: 0;
          margin: 0;
          margin-bottom: 0.2rem;
        }

        & input#taskInput {
          width: 100%;
          margin: 0;
          padding: 0.35rem 0.35rem;
          margin-top: 0.375rem;
          border-radius: 0.43rem;
          background-color: var(--input);
          color: var(--foreground);
          border: var(--input-border);
          border-bottom: var(--input-border-bottom);
          outline: none;

          &:focus {
            outline: var(--input-focus-outline);
          }
        }

        & .button-container {
          padding: 0;
          margin: 0;
          margin-top: 1.25rem;
          display: flex;
          flex-direction: row;
          justify-content: flex-end;
          gap: 0.625rem;

          & button#cancel,
          & button#ok {
            min-width: 4rem;
            padding: 0.25rem 0.55rem;
            border-radius: 0.3rem;
            border: none;
            margin: 0;
            box-shadow: var(--button-shadow);
          }

          & button#cancel {
            background-color: var(--button);
            color: var(--foreground);
            border-top: var(--button-border-top);
            border-bottom: var(--button-border-bottom);

            &:active {
              background-color: var(--button-active);
              border-top: var(--button-border-top-active);
            }
          }

          & button#ok {
            background: var(--button-primary);
            color: var(--button-primary-text);
            border-top: var(--button-primary-border-top);
            border-bottom: var(--button-primary-border-bottom);

            &:active {
              background: var(--button-primary-active);
              border-top: var(--button-primary-border-top-active);
            }
          }
        }
      }
    </style>
  </head>
  <body>
    <div id="form">
      <label for="taskInput" id="label"></label>
      <input type="text" id="taskInput" placeholder="Task" autofocus />
      <div class="button-container">
        <button id="cancel">Cancel</button>
        <button id="ok">Done</button>
      </div>
    </div>

    <script>
      const { ipcRenderer } = require('electron')

      const taskInput = document.getElementById('taskInput')
      const okButton = document.getElementById('ok')
      const cancelButton = document.getElementById('cancel')
      const label = document.getElementById('label')

      // Get mode and set label text
      ipcRenderer.invoke('get-mode').then((mode) => {
        label.textContent = mode === 'edit' ? 'Edit Task:' : 'New Task:'
      })

      // Set initial value if provided
      ipcRenderer.invoke('get-initial-value').then((value) => {
        taskInput.value = value || ''
        taskInput.select()
      })

      // Handle form submission
      function submitForm() {
        ipcRenderer.invoke('submit-prompt', taskInput.value)
      }

      // Handle cancel
      function cancel() {
        ipcRenderer.invoke('cancel-prompt')
      }

      // Event listeners
      okButton.addEventListener('click', submitForm)
      cancelButton.addEventListener('click', cancel)

      // Handle Enter key
      taskInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          submitForm()
        }
      })

      // Handle Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          cancel()
        }
      })
    </script>
  </body>
</html>
